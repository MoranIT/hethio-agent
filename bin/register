#!/bin/sh
#
# Register with heth.io
#

source globals.sh

echo "Registering Device..."

#READ PUBLIC IP ADDRESS FROM LOG FILE IF EXISTS
if [ -f "$MPATH/log/publicip.log" ]; then
PUBLICIP=`awk '/./{line=$0} END{print line}' $MPATH/log/publicip.log`
else
PUBLICIP='UNKNOWN'
fi


#READ SPEED TEST RESULTS FROM LOG FILE IF EXISTS
if [ -f "$MPATH/log/speedtest.log" ]; then
SPEEDTEST=`awk '/./{line=$0} END{print line}' $MPATH/log/speedtest.log`
else
SPEEDTEST='UNKNOWN'
fi


#READ TEMPERATURE FROM LOG FILE IF EXISTS
if [ -f "$MPATH/log/temperature.log" ]; then
TEMPERATURE=`awk '/./{line=$0} END{print line}' $MPATH/log/temperature.log`
else
TEMPERATURE='UNKNOWN'
fi



message "register" "{'hostname':'$HOSTNAME','publicip':'$PUBLICIP','speedtest':'$SPEEDTEST','temperature':'$TEMPERATURE','timestamp':'$DATETIME'}"

echo "Done"