#!/bin/bash
#
# Read Temperature from system file
#

source globals.sh

if [ -f "/sys/class/thermal/thermal_zone0/temp" ]; then
	echo "Reading Device Temperature..."

	TEMP=`cat /sys/class/thermal/thermal_zone0/temp`

	echo "$TEMP|$DATETIME" >> $MPATH/log/temperature.log



	#- TEMP - 
	if [ -f "$MPATH/log/temperature.log" ]; then
	TEMPERATURE=`awk '/./{line=$0} END{print line}' $MPATH/log/temperature.log | cut -d'|' -f1`
	else
	TEMPERATURE='UNKNOWN'
	fi
	TEMP="'temperature':'$TEMPERATURE'"


	# Send message to central server
	publish "machines/$ID/temperature" "{$TEMP}"


	echo "Done"
else
	echo "Unable to read temperature, missing file."
fi
